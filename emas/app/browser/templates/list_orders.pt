<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xml:lang="en" lang="en"
      i18n:domain="plone"
      metal:use-macro="here/main_template/macros/master">

  <head>
      <metal:block fill-slot="top_slot">
        <tal:insert tal:replace="nothing"
              tal:define="dummy python:request.set('enable_border', 1)" />
      </metal:block>
  </head>

  <body>

      <metal:content-title fill-slot="content-title">
          <h1 class="documentFirstHeading"> 
              <tal:block condition="exists:here/aq_explicit/widget">
                  <metal:field use-macro="python:here.widget('title', mode='view')">
                  Title
                  </metal:field>
              </tal:block>
              <tal:block condition="not:exists:here/aq_explicit/widget">
                  <span tal:content="view/title" tal:omit-tag="">Directory Id</span>
              </tal:block>
          </h1>        
      </metal:content-title>
      
      <metal:content-description fill-slot="content-description">
          <div class="documentDescription" tal:condition="exists:here/aq_explicit/widget">
              <metal:field use-macro="python:here.widget('description', mode='view')">
                  Description
              </metal:field>
          </div>
          <tal:block condition="not:exists:here/aq_explicit/widget">
              <div class="documentDescription" 
                         tal:content="context/Description" 
                         tal:condition="context/Description"> 
                  Description
              </div>
          </tal:block>
      </metal:content-description>

      <metal:content-core fill-slot="content-core">
      <div id="search-form">
          <form action="." method="POST" name="order-filter">
              <table id="search-form-table">
                  <tr>
                      <td>
                          <label for="review_state">
                              State
                          </label>
                      </td>
                      <td>
                          <select id="select-review-state" name="review_state" class="select-widget choice-field">
                              <option></option>
                              <option tal:repeat="details view/review_states" value="state"
                                  tal:attributes="value python:details[0]">
                                <span tal:replace="python:details[1]">Ordered</span>
                              </option>
                          </select>
                      </td>
                      <td>
                          <label for="payment_method">
                              Payment method
                          </label>
                      </td>
                      <td>
                          <select id="select-payment-method" name="payment_method" class="select-widget choice-field">
                              <option></option>
                              <option tal:repeat="details view/payment_methods" value="payment_method"
                                  tal:attributes="value details/token">
                                <span tal:replace="details/title">EFT</span>
                              </option>
                          </select>
                      </td>
                  </tr>
                  <tr>
                      <td>
                          <label for="userid">
                              User id 
                          </label>
                      </td>
                      <td>
                          <input id="userid" name="userid" value=""
                              tal:attributes="value request/userid |nothing"/> <br/>
                      </td>
                      <td>
                          <label for="related_item_uuids">
                              Related services
                          </label>
                      </td>
                      <td>
                          <select id="select-related-services" name="related_item_uuids">
                              <option></option>
                              <option tal:repeat="details view/services" value="service"
                                tal:attributes="value python:details[0]">
                                  <span tal:replace="python:details[1]">service title</span>
                              </option>
                          </select>
                      </td>
                  </tr>
                  <tr>
                      <td>
                          <label for="start_date">
                              Start date
                          </label>
                      </td>
                      <td>
                          <input id="start_date" name="order_date.start:record:date:ignore_empty" value="" type="date"
                              tal:attributes="value request/start_date |nothing"/> <br/>
                      </td>
                      <td>
                          <label for="end_date">
                              End date
                          </label>
                      </td>
                      <td>
                          <input id="end_date" name="order_date.end:record:date:ignore_empty" value="" type="date"
                              tal:attributes="value request/end_date |nothing"/> <br/>
                      </td>
                  </tr>
                  <tr colspan="2">
                      <td>
                          <label for="verification_code">
                              Verification code
                          </label>
                      </td>
                      <td>
                          <input id="verification_code" name="verification_code" value=""
                              tal:attributes="value request/verification_code |nothing"/> <br/>
                      </td>
                      <td>
                          <label for="order_number">
                              Order number
                          </label>
                      </td>
                      <td>
                          <input id="order_number" name="order_number" value=""
                              tal:attributes="value request/order_number |nothing"/> <br/>
                      </td>
                  </tr>
                  <tr>
                      <td>
                          <input type="submit" name="list_orders.form.submitted"
                            class="standalone multiSubmit" value="Search" />
                      </td>
                  </tr>
              </table>
          </form>
      </div>
      <tal:defines define="order_brains view/orders">

      <tal:orders condition="order_brains">
      <table class="listing"
          tal:define="toLocalizedTime nocall:context/@@plone/toLocalizedTime;">

            <tr>
                <th>State</th>
                <th>Payment method</th>
                <th>User id</th>
                <th>Related services</th>
                <th>Order date</th>
                <th>Order number</th>
                <th>Verification code</th>
            </tr>
            <tal:display-orders repeat="brain order_brains">
            <tr tal:define="order python:brain.getObject()">
                <td tal:content="python:view.get_review_state_for(order)">
                    State
                </td>
                <td tal:content="order/payment_method">
                    CC|EFT|PRSMS
                </td>
                <td tal:content="order/userid">
                    User007
                </td>
                <td tal:define="services python:view.get_related_services_for(order)">
                    <tal:services repeat="service services">
                    <span tal:content="service">Related services</span><br/>
                    </tal:services>
                </td>
                <td tal:content="python:toLocalizedTime(order.creation_date)">
                    01 Jan 1970
                </td>
                <td tal:content="order/Title">
                    Order nnn
                </td>
                <td tal:content="order/verification_code">
                    44444
                </td>
            </tr>
            </tal:display-orders>
          </table>
      </tal:orders>

      </tal:defines>
      </metal:content-core>
      
  </body>
</html>
