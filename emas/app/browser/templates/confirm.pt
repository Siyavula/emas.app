<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="emas.theme">
<body>

    <metal:core fill-slot="main">
        <h1 class="documentFirstHeading">Order confirmation</h1>

        <div id="content-core"
            tal:define="isAnon context/@@plone_portal_state/anonymous;
                        warnings view/warnings | nothing;">

            <div id="payment-form-container" class="selectpackage">
                <p>The total cost of your order is: <strong><tal:cost tal:replace="view/totalcost"/></strong></p>

                <tal:eft tal:condition="view/eft_selected">
                    <p>You will receive an email to confirm your order. The
                    confirmation email will contain the instructions for
                    payment as described below. Your services will only be
                    activated once we have received payment.</p>

                    <p>
                    Payment for this order can be made using an electronic
                    funds transfer (EFT) to the bank account below. Please
                    ensure that you use the correct reference number as
                    specified below.
                    </p>

                    <pre class="bankdetails">
    Account name:   Siyavula Education
    Bank:           Nedbank
    Account number: 1018177434
    Branch code:    198765
    Reference:      <tal:username tal:replace="view/ordernumber"/>
                    </pre>

                    <div class="ordertotal">
                        <form method="POST" action=".">
                            <button type="submit" tal:condition="warnings"
                                class="button generic no-icon small-caps allowMultiSubmit"
                                name="continue" value="1">
                                Continue
                            </button>
                        </form>
                    </div>
                </tal:eft>

                <tal:sms tal:condition="view/sms_selected">
                    <div>
                        In order to complete this transaction and pay, please
                        SMS '<span tal:replace="view/verification_code">verification
                        code</span>' to <span tal:replace="view/premium_number">
                        premium number</span>.
                    </div>
                    <div>
                        Once your SMS payment has been confirmed, you can <a href="#" tal:attributes="href string:${context/absolute_url}/@@practice">click here to go to Intelligent Practice.</a>
                    </div>
                </tal:sms>

                <form id="payment-form" method="POST" action="."
                    tal:attributes="action view/action"
                    tal:condition="view/creditcard_selected">

                    <fieldset>
                        <input name="orderid" value="4444" type="hidden"
                            tal:attributes="value view/order/getId">

                        <input type="hidden" name="p1" value="1"
                            tal:attributes="value view/vcs_terminal_id">

                        <input type="hidden" name="p2" value="1"
                            tal:attributes="value view/tid">
                            
                        <input type="hidden" name="p3" value="1"
                            tal:attributes="value view/description">
                            
                        <input type="hidden" name="p4" value="1"
                            tal:attributes="value view/cost">

                        <input type="hidden" name="m_1" value="1"
                            tal:attributes="value string:${view/returnurl}">
                            
                        <input type="hidden" name="hash" value="1"
                            tal:attributes="value view/md5hash">

                        <input name="prod_payment" value="creditcard"
                            tal:attributes="checked view/creditcard_selected"
                            type="hidden" checked="checked">

                        <div class="ordertotal">
                            <button tal:condition="not:warnings"
                                id="makepayment"
                                type="submit" 
                                class="btn btn-large allowMultiSubmit"
                                name="makepayment" value="make payment">
                                Make payment
                            </button>

                            <button type="submit" tal:condition="warnings"
                                class="btn btn-large allowMultiSubmit"
                                name="continue" value="1">
                                I understand, make payment
                            </button>
                        </div>
                            
                    </fieldset>
                </form>
                
                <tal:warnings condition="warnings">
                <div id="duplicate-payment-warning" class="warning">
                    You have already paid for the following: <br/>
                    <ul>
                        <li tal:repeat="warning warnings" tal:content="warning/title">
                            warning
                        </li>
                    </ul>
                </div>
                </tal:warnings>

                <p>You have ordered the following:</p>
                <ul class="nodots">
                    <li tal:content="view/service_ordered">
                        6 month subscription to Maths Grade 10, 11 and 12
                    </li>
                </ul>

                <div>
                    Order Number: <span tal:replace="view/ordernumber">1000</span>
                </div>

                <p>Thank you for your order!</p>

                <form class="backbutton" action="." method="POST"
                    tal:attributes="action string:${context/absolute_url}/@@order">

                    <!-- all the values from the order form, in case we 
                         want to go back to it.
                    -->
                    <input name="ordernumber" value="" type="hidden"
                        tal:attributes="value view/ordernumber">

                    <input name="subjects" value="" type="hidden"
                        tal:attributes="value view/subjects">

                    <input name="prod_payment" value="" type="hidden"
                        tal:attributes="value view/prod_payment" >
                        
                    <button tal:condition="not:view/sms_selected"
                        id="back" type="submit"
                        class="btn btn-large allowMultiSubmit"
                        name="confirm_back_button" 
                        value="back">
                        Change order
                    </button>
                </form>

            </div>
        </div>

    </metal:core>

</body>
</html>
